"""
Try building a complex through importing architector.
"""

# Imports
import unittest
import architector.complex_construction as arch_bc
import architector.io_align_mol as io_align_mol
import shutil
import os

refmol = """"
@<TRIPOS>MOLECULE
01
    95   100     1     0     0
SMALL
NO_CHARGES
****
Generated from the CSD

@<TRIPOS>ATOM
     1 C1       4.1897   0.7721   8.3534   C.2       1 RES1   0.0000
     2 C2       5.5556   0.8735   7.8230   C.2       1 RES1   0.0000
     3 C3       6.6094   1.3923   8.6547   C.2       1 RES1   0.0000
     4 C4       6.2550   1.7886   9.9262   C.2       1 RES1   0.0000
     5 H1       6.9385   2.1414  10.4830   H         1 RES1   0.0000
     6 C5       4.9261   1.7067  10.4738   C.2       1 RES1   0.0000
     7 C6       3.9273   1.1908   9.6799   C.2       1 RES1   0.0000
     8 H2       3.0473   1.1133  10.0282   H         1 RES1   0.0000
     9 C7       8.0468   1.4916   8.1208   C.3       1 RES1   0.0000
    10 C8       8.0907   2.3840   6.8664   C.3       1 RES1   0.0000
    11 H3       7.6965   3.2569   7.0726   H         1 RES1   0.0000
    12 H4       7.5826   1.9585   6.1447   H         1 RES1   0.0000
    13 H5       9.0210   2.5048   6.5835   H         1 RES1   0.0000
    14 C9       8.5510   0.0779   7.7668   C.3       1 RES1   0.0000
    15 H6       9.4917   0.1245   7.4965   H         1 RES1   0.0000
    16 H7       8.0169  -0.2849   7.0303   H         1 RES1   0.0000
    17 H8       8.4652  -0.5044   8.5504   H         1 RES1   0.0000
    18 C10      8.9949   2.0965   9.1610   C.3       1 RES1   0.0000
    19 H9       8.6723   2.9845   9.4199   H         1 RES1   0.0000
    20 H10      9.8940   2.1752   8.7772   H         1 RES1   0.0000
    21 H11      9.0261   1.5171   9.9503   H         1 RES1   0.0000
    22 C11      4.6780   2.2172  11.8943   C.3       1 RES1   0.0000
    23 C12      5.5787   1.4628  12.8840   C.3       1 RES1   0.0000
    24 H12      6.5173   1.5868  12.6309   H         1 RES1   0.0000
    25 H13      5.3581   0.5081  12.8646   H         1 RES1   0.0000
    26 H14      5.4359   1.8130  13.7879   H         1 RES1   0.0000
    27 C13      3.2172   2.0165  12.3365   C.3       1 RES1   0.0000
    28 H15      3.1079   2.3324  13.2586   H         1 RES1   0.0000
    29 H16      2.9887   1.0648  12.2895   H         1 RES1   0.0000
    30 H17      2.6233   2.5243  11.7454   H         1 RES1   0.0000
    31 C14      5.0159   3.7132  11.9481   C.3       1 RES1   0.0000
    32 H18      4.8930   4.0440  12.8623   H         1 RES1   0.0000
    33 H19      4.4226   4.2035  11.3410   H         1 RES1   0.0000
    34 H20      5.9473   3.8484  11.6743   H         1 RES1   0.0000
    35 C15      4.5710   2.7272   4.9075   C.ar      1 RES1   0.0000
    36 H21      5.4348   2.4761   5.2134   H         1 RES1   0.0000
    37 C16      4.3837   4.0080   4.4138   C.ar      1 RES1   0.0000
    38 C17      3.1357   4.3894   3.9522   C.ar      1 RES1   0.0000
    39 C18      2.1098   3.4457   4.0163   C.ar      1 RES1   0.0000
    40 C19      2.3752   2.1876   4.5249   C.ar      1 RES1   0.0000
    41 H22      1.6718   1.5503   4.5582   H         1 RES1   0.0000
    42 N1       3.5857   1.8341   4.9694   N.ar      1 RES1   0.0000
    43 O1       3.2818   0.3149   7.5698   O.3       1 RES1   0.0000
    44 O2       5.7274   0.4788   6.6007   O.2       1 RES1   0.0000
    45 Cl1      0.5178   3.8136   3.4613   Cl        1 RES1   0.0000
    46 Cl2      2.8688   5.9627   3.3087   Cl        1 RES1   0.0000
    47 Cl3      5.7365   5.0907   4.3775   Cl        1 RES1   0.0000
    48 Co1      3.9992  -0.1841   5.7278   Co.oh     1 RES1   0.0000
    49 C1A      3.8088  -1.1403   3.1022   C.2       1 RES1   0.0000
    50 C2A      2.4428  -1.2416   3.6325   C.2       1 RES1   0.0000
    51 C3A      1.3891  -1.7605   2.8009   C.2       1 RES1   0.0000
    52 C4A      1.7434  -2.1568   1.5293   C.2       1 RES1   0.0000
    53 H1A      1.0599  -2.5096   0.9726   H         1 RES1   0.0000
    54 C5A      3.0724  -2.0749   0.9817   C.2       1 RES1   0.0000
    55 C6A      4.0711  -1.5590   1.7756   C.2       1 RES1   0.0000
    56 H2A      4.9511  -1.4815   1.4274   H         1 RES1   0.0000
    57 C7A     -0.0483  -1.8598   3.3347   C.3       1 RES1   0.0000
    58 C8A     -0.0922  -2.7522   4.5891   C.3       1 RES1   0.0000
    59 H3A      0.3020  -3.6251   4.3829   H         1 RES1   0.0000
    60 H4A      0.4158  -2.3267   5.3108   H         1 RES1   0.0000
    61 H5A     -1.0226  -2.8730   4.8720   H         1 RES1   0.0000
    62 C9A     -0.5525  -0.4461   3.6887   C.3       1 RES1   0.0000
    63 H6A     -1.4933  -0.4927   3.9590   H         1 RES1   0.0000
    64 H7A     -0.0184  -0.0832   4.4253   H         1 RES1   0.0000
    65 H8A     -0.4667   0.1362   2.9051   H         1 RES1   0.0000
    66 C10A    -0.9964  -2.4647   2.2945   C.3       1 RES1   0.0000
    67 H9A     -0.6739  -3.3527   2.0356   H         1 RES1   0.0000
    68 H10A    -1.8955  -2.5434   2.6783   H         1 RES1   0.0000
    69 H11A    -1.0276  -1.8853   1.5053   H         1 RES1   0.0000
    70 C11A     3.3204  -2.5854  -0.4387   C.3       1 RES1   0.0000
    71 C12A     2.4198  -1.8310  -1.4285   C.3       1 RES1   0.0000
    72 H12A     1.4812  -1.9550  -1.1753   H         1 RES1   0.0000
    73 H13A     2.6403  -0.8763  -1.4090   H         1 RES1   0.0000
    74 H14A     2.5626  -2.1811  -2.3323   H         1 RES1   0.0000
    75 C13A     4.7813  -2.3847  -0.8809   C.3       1 RES1   0.0000
    76 H15A     4.8906  -2.7006  -1.8031   H         1 RES1   0.0000
    77 H16A     5.0098  -1.4330  -0.8340   H         1 RES1   0.0000
    78 H17A     5.3752  -2.8924  -0.2898   H         1 RES1   0.0000
    79 C14A     2.9826  -4.0814  -0.4926   C.3       1 RES1   0.0000
    80 H18A     3.1055  -4.4122  -1.4067   H         1 RES1   0.0000
    81 H19A     3.5759  -4.5717   0.1146   H         1 RES1   0.0000
    82 H20A     2.0512  -4.2166  -0.2188   H         1 RES1   0.0000
    83 C15A     3.4275  -3.0954   6.5480   C.ar      1 RES1   0.0000
    84 H21A     2.5636  -2.8443   6.2421   H         1 RES1   0.0000
    85 C16A     3.6147  -4.3762   7.0417   C.ar      1 RES1   0.0000
    86 C17A     4.8628  -4.7576   7.5034   C.ar      1 RES1   0.0000
    87 C18A     5.8886  -3.8139   7.4392   C.ar      1 RES1   0.0000
    88 C19A     5.6233  -2.5558   6.9306   C.ar      1 RES1   0.0000
    89 H22A     6.3267  -1.9185   6.8974   H         1 RES1   0.0000
    90 N1A      4.4128  -2.2023   6.4861   N.ar      1 RES1   0.0000
    91 O1A      4.7166  -0.6831   3.8857   O.3       1 RES1   0.0000
    92 O2A      2.2711  -0.8470   4.8549   O.2       1 RES1   0.0000
    93 Cl1A     7.4806  -4.1818   7.9942   Cl        1 RES1   0.0000
    94 Cl2A     5.1297  -6.3309   8.1468   Cl        1 RES1   0.0000
    95 Cl3A     2.2619  -5.4589   7.0780   Cl        1 RES1   0.0000
@<TRIPOS>BOND
     1     1     2    1
     2     2     3    1
     3     3     4    2
     4     4     5    1
     5     6     4    1
     6     7     1    2
     7     8     7    1
     8     9     3    1
     9    10     9    1
    10    11    10    1
    11    12    10    1
    12    13    10    1
    13    14     9    1
    14    15    14    1
    15    16    14    1
    16    17    14    1
    17    18     9    1
    18    19    18    1
    19    20    18    1
    20    21    18    1
    21    22     6    1
    22    23    22    1
    23    24    23    1
    24    25    23    1
    25    26    23    1
    26    27    22    1
    27    28    27    1
    28    29    27    1
    29    30    27    1
    30    31    22    1
    31    32    31    1
    32    33    31    1
    33    34    31    1
    34    35    36    1
    35    37    35   ar
    36    38    37   ar
    37    39    38   ar
    38    40    39   ar
    39    41    40    1
    40    42    35   ar
    41    43     1    1
    42    44     2    2
    43    45    39    1
    44    46    38    1
    45    47    37    1
    46    48    42    1
    47    49    50    1
    48    50    51    1
    49    51    52    2
    50    52    53    1
    51    54    52    1
    52    55    49    2
    53    56    55    1
    54    57    51    1
    55    58    57    1
    56    59    58    1
    57    60    58    1
    58    61    58    1
    59    62    57    1
    60    63    62    1
    61    64    62    1
    62    65    62    1
    63    66    57    1
    64    67    66    1
    65    68    66    1
    66    69    66    1
    67    70    54    1
    68    71    70    1
    69    72    71    1
    70    73    71    1
    71    74    71    1
    72    75    70    1
    73    76    75    1
    74    77    75    1
    75    78    75    1
    76    79    70    1
    77    80    79    1
    78    81    79    1
    79    82    79    1
    80    83    84    1
    81    85    83   ar
    82    86    85   ar
    83    87    86   ar
    84    88    87   ar
    85    89    88    1
    86    90    48    1
    87    91    48    1
    88    92    48    1
    89    93    87    1
    90    94    86    1
    91    95    85    1
    92     6     7    1
    93    40    42   ar
    94    43    48    1
    95    44    48    1
    96    49    91    1
    97    50    92    2
    98    54    55    1
    99    83    90   ar
   100    88    90   ar
@<TRIPOS>SUBSTRUCTURE
     1 RES1        1 GROUP             0 ****  ****    0  
@<TRIPOS>CRYSIN
    1.0000    1.0000    1.0000   90.0000   90.0000   90.0000     1     1
"""


# Functions
class Test02import(unittest.TestCase):
    @classmethod
    def setUpClass(cls):
        cls.crestPath = shutil.which('crest')
        cls.path = os.path.abspath('.')


    def test_import(self):
        inputDict = {'core': {'smiles': '[Co]', 'coreType': 'octahedral'}, 
        'ligands': [{'smiles': 'CC(C)(C)C1=CC(=O)C(=O)C(=C1)C(C)(C)C', 'coordList': [7, 9], 'ligType': 'bi_cis'}, 
        {'smiles': 'Clc1cncc(Cl)c1Cl', 'coordList': [3], 'ligType': 'mono'}, 
        {'smiles': 'CC(C)(C)C1=CC(=O)C(=O)C(=C1)C(C)(C)C', 'coordList': [7, 9], 'ligType': 'bi_cis'}, 
        {'smiles': 'Clc1cncc(Cl)c1Cl', 'coordList': [3], 'ligType': 'mono'}],
         'parameters': {'relax':False, 'n_conformers':2,
         'assemble_method':'GFN-FF'}, #Conformers to 2 to make sure we get the right one out.
         'refcode_plus': 'TAWKAG_comp_0'
        }

        # Build complex
        out = arch_bc.build_complex(inputDict)
        keys = out.keys()
        good = False
        for key in keys: # Check for rmsd vs. reference for all generated complexes.
            rmsd_core, rmsd_full, _ = io_align_mol.calc_rmsd(out[key]['mol2string'],refmol)
            #with open(key+'.mol2','w') as file1:
            #    file1.write(out[key]['mol2string'])
            if (rmsd_core < 1) and (rmsd_full < 2.5):
                good = True
        self.assertEqual(good,True)

if __name__ == "__main__":
    unittest.main()
